{% extends 'baseAdmin.html.twig' %}

{% block title %}Parcelle index{% endblock %}

{% block body %}
<section class="mb-6 2xl:mb-0 2xl:flex-1">
    <div class="container">
        <h2 class="text-2xl font-bold text-bgray-900 dark:text-white mb-6">Liste des Cultures Parcelles</h2>
        <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
            {% for parcelle in parcelles %}
                <div class="rounded-lg bg-white p-5 dark:bg-darkblack-600 shadow-lg">
                    <a href="{{ path('app_parcelle_show', {'id': parcelle.id}) }}">
                        <div id="map-{{ parcelle.id }}" class="mini-map rounded-lg overflow-hidden"></div>
                    </a>
                    <div class="mt-4 flex items-center space-x-3">
                        <img src="{{ asset('assets/images/icons/farm.svg') }}" alt="icon" class="w-8 h-8">
                        <p class="text-lg font-semibold text-bgray-900 dark:text-white">
                            {{ parcelle.nom }} - Irrigation: {{ parcelle.irrigationDisponible ? 'Oui' : 'Non' }}
                        </p>
                    </div>
                    <h4 class="text-bgray-700 dark:text-bgray-50">
                        {{ parcelle.superficie }} ha - {{ parcelle.latitude }}° {{ parcelle.longitude }}°
                    </h4>
                </div>
            {% else %}
                <p class="text-center text-bgray-700 dark:text-bgray-50">Aucune parcelle trouvée.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Intégration des scripts Mapbox -->
<script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">

<style>
    .mini-map {
        width: 100%;
        height: 250px;
        border-radius: 10px;
    }
</style>

<script>
    mapboxgl.accessToken = "{{ MAPBOX_API_KEY }}";
    {% for parcelle in parcelles %}
        var map{{ parcelle.id }} = new mapboxgl.Map({
            container: 'map-{{ parcelle.id }}',
            style: 'mapbox://styles/mapbox/satellite-streets-v11',
            center: [{{ parcelle.longitude }}, {{ parcelle.latitude }}],
            zoom: 16,
            interactive: false
        });
        new mapboxgl.Marker().setLngLat([{{ parcelle.longitude }}, {{ parcelle.latitude }}]).addTo(map{{ parcelle.id }});
    {% endfor %}
</script>

<!-- Link to Create New Parcelle -->
<div class="text-center mt-6">
    <a href="{{ path('app_parcelle_new') }}" class="btn bg-primary text-white px-4 py-2 rounded-lg shadow-md hover:bg-opacity-80">
        <i class="fa fa-plus"></i> Créer une nouvelle parcelle
    </a>
</div>
{% endblock %}