{% extends 'baseAdmin.html.twig' %}

{% block title %}Parcelle - {{ parcelle.nom }}{% endblock %}

{% block body %}
<div class="main-panel">
    <div class="content-wrapper">
        <!-- üü¢ Page Header -->
        <div class="page-header">
            <h3 class="page-title">
                <span class="page-title-icon bg-gradient-primary text-white me-2">
                    <i class="mdi mdi-map-marker"></i>
                </span> D√©tails de la Parcelle
            </h3>
            <nav aria-label="breadcrumb">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{{ path('app_dashboard') }}">Accueil</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Parcelle - {{ parcelle.nom }}</li>
                </ul>
            </nav>
        </div>

        <!-- üåø Parcelle Details -->
        <div class="row">
            <!-- üó∫Ô∏è Carte -->
            <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Localisation</h4>
                        <div id="map" style="
                            width: 100%;
                            height: 500px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                        "></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- üìã Informations Parcelle -->
            <div class="col-lg-6 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Informations de la Parcelle</h4>
                        <ul class="list-unstyled">
                            <li><strong>üìå Nom :</strong> {{ parcelle.nom }}</li>
                            <li><strong>üìè Superficie :</strong> {{ parcelle.superficie }} m¬≤</li>
                            <li><strong>üß≠ Latitude :</strong> {{ parcelle.latitude }}</li>
                            <li><strong>üß≠ Longitude :</strong> {{ parcelle.longitude }}</li>
                            <li>
                                <strong>üí¶ Irrigation :</strong>
                                <span class="badge {{ parcelle.irrigationDisponible ? 'bg-success' : 'bg-danger' }}">
                                    {{ parcelle.irrigationDisponible ? 'Oui' : 'Non' }}
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- üìù Description -->
            <div class="col-lg-6 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Description</h4>
                        <p>Voici la carte affichant la localisation de votre parcelle. Vous pouvez visualiser son emplacement exact et g√©rer son suivi en temps r√©el.</p>
                        <p>Utilisez les outils de navigation pour zoomer et explorer l'environnement autour de la parcelle.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- üéØ Actions -->
        <div class="row">
            <div class="col-lg-12 text-center mt-4">
                <a href="{{ path('app_parcelle_dashboard_index') }}" class="btn btn-gradient-primary me-2">
                    <i class="mdi mdi-arrow-left"></i> Retour √† la liste
                </a>
                <a href="{{ path('app_parcelle_edit2', {'id': parcelle.id}) }}" class="btn btn-gradient-warning">
                    <i class="mdi mdi-pencil"></i> Modifier
                </a>
                {{ include('parcelle/_delete_form.html.twig') }}
            </div>
        </div>

        <!-- üåç Mapbox Integration -->
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
        <script>
            mapboxgl.accessToken = "{{ MAPBOX_API_KEY }}";
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/satellite-streets-v11',
                center: [{{ parcelle.longitude }}, {{ parcelle.latitude }}],
                zoom: 15,
                pitch: 45,
                bearing: -17.6
            });

            var marker = new mapboxgl.Marker({ color: 'red' })
                .setLngLat([{{ parcelle.longitude }}, {{ parcelle.latitude }}])
                .setPopup(new mapboxgl.Popup({ offset: 25 })
                    .setHTML(`<h6>{{ parcelle.nom }}</h6><p>{{ parcelle.superficie }} m¬≤</p>`))
                .addTo(map);
            
            map.addControl(new mapboxgl.NavigationControl());
            map.addControl(new mapboxgl.FullscreenControl());
        </script>
    </div>
</div>
{% endblock %}
